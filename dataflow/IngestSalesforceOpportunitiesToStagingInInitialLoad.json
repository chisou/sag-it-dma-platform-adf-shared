{
	"name": "IngestSalesforceOpportunitiesToStagingInInitialLoad",
	"properties": {
		"folder": {
			"name": "Salesforce"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "SalesforceOpportunitiesFromBlob",
						"type": "DatasetReference"
					},
					"name": "SalesforceOpportunitiesFromBlob"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "StgSfOpportunityToStagingIn",
						"type": "DatasetReference"
					},
					"name": "StoreToDatabase"
				}
			],
			"transformations": [
				{
					"name": "JsonToTabularFormat"
				},
				{
					"name": "RemoveNullValuesFromId"
				},
				{
					"name": "ConvertIngestionDateFromStringToDate"
				}
			],
			"script": "source(output(\n\t\tOpportunity as ({@xsi:type} as string, ALTF__Altify_Opportunity__c as string, AccountId as string, Age__c as double, Altify_Completeness__c as double, Altify_Opportunity_Plan_Score__c as double, Altify_Plan_Status__c as string, Altify_Reporting_Amount__c as double, Altify_Sales_Process_Status__c as string, Altify_T_I_Status__c as string, Amount as double, Amount_100__c as double, Amount_10__c as double, Amount_30__c as double, Amount_50__c as double, Amount_70__c as double, Amount_90__c as double, Amount_A2_Bookings__c as double, Amount_A_N_Bookings__c as double, Amount_Bookings_Value__c as double, Amount_Bookings__c as double, Amount_DBP_Combined_Bookings__c as double, Amount_Integration_Bookings__c as double, Amount_IoT_Analytics_Bookings__c as double, Amount_TrendMiner_Bookings__c as double, Amount_Value__c as double, Board_Responsible__c as string, CMS_Case_Number__c as double, CMS_Link__c as string, CampaignId as string, Classification_SolutionType__c as string, CloseDate as date, Cluster__c as string, ContactId as string, Count_Opp_Partners__c as double, Count_Primary_Partners__c as double, CreatedById as string, CreatedDate as string, CurrencyIsoCode as string, Date_100__c as date, Date_30__c as date, Date_50__c as date, Date_5__c as date, Date_70__c as date, Date_90__c as date, Deal_Type__c as string, Description as string, Division__c as string, Duration_10_30__c as double, Duration_30_50__c as double, Duration_50_70__c as double, Duration_70_90__c as double, Duration_90_100__c as double, ForecastCategory as string, ForecastCategoryName as string, GDD_Number__c as string, GDD_Version_Number__c as short, Healthiness_Category__c as string, Id as string, Incremental__c as boolean, Industry__c as string, IsClosed as boolean, IsWon as boolean, KeyWords__c as string, LastActivityDate as date, LastModifiedDate as string, LeadSource as string, Name as string, Opportunity_Number__c as integer, Opportunity_Record_Type_Text__c as string, Opportunity_Source__c as string, Outreach_Last_Touch_Contact__c as string, Outreach_Last_Touch_Sequence__c as string, OwnerId as string, Primary_Campaign_Category__c as string, Primary_Contact__c as string, Probability as double, Reason_s_for_competitive_loss__c as string, Reason_s_for_non_competitive_loss__c as string, RecordTypeId as string, Renewal__c as boolean, SAG_Organization_Account__c as string, SAG_Organization__c as string, SQO_Accepted_Date__c as date, SQO_Accepted_Month__c as double, SQO_Age__c as double, Sales_Organization__c as string, Sales_Plays__c as string, Sales_Region__c as string, Sales_Sub_Region__c as string, StageName as string, Type as string, Type_of_Opportunity__c as string, {ens:type} as string)[]\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\trowUrlColumn: 'IngestionDate',\n\tdocumentForm: 'documentPerLine',\n\twildcardPaths:['Salesforce/Opportunity/*/*/*.json']) ~> SalesforceOpportunitiesFromBlob\nSalesforceOpportunitiesFromBlob foldDown(unroll(Opportunity),\n\tmapColumn(\n\t\tId = Opportunity.Id,\n\t\tAccountId = Opportunity.AccountId,\n\t\tRecordTypeId = Opportunity.RecordTypeId,\n\t\tName = Opportunity.Name,\n\t\tDescription = Opportunity.Description,\n\t\tStageName = Opportunity.StageName,\n\t\tAmount = Opportunity.Amount,\n\t\tProbability = Opportunity.Probability,\n\t\tCloseDate = Opportunity.CloseDate,\n\t\tType = Opportunity.Type,\n\t\tLeadSource = Opportunity.LeadSource,\n\t\tIsClosed = Opportunity.IsClosed,\n\t\tIsWon = Opportunity.IsWon,\n\t\tForecastCategory = Opportunity.ForecastCategory,\n\t\tForecastCategoryName = Opportunity.ForecastCategoryName,\n\t\tCurrencyIsoCode = Opportunity.CurrencyIsoCode,\n\t\tCampaignId = Opportunity.CampaignId,\n\t\tOwnerId = Opportunity.OwnerId,\n\t\tCreatedDate = Opportunity.CreatedDate,\n\t\tCreatedById = Opportunity.CreatedById,\n\t\tLastModifiedDate = Opportunity.LastModifiedDate,\n\t\tLastActivityDate = Opportunity.LastActivityDate,\n\t\tContactId = Opportunity.ContactId,\n\t\tSales_Plays__c = Opportunity.Sales_Plays__c,\n\t\tCMS_Case_Number__c = Opportunity.CMS_Case_Number__c,\n\t\tHealthiness_Category__c = Opportunity.Healthiness_Category__c,\n\t\tSAG_Organization__c = Opportunity.SAG_Organization__c,\n\t\tClassification_SolutionType__c = Opportunity.Classification_SolutionType__c,\n\t\tOpportunity_Source__c = Opportunity.Opportunity_Source__c,\n\t\tIndustry__c = Opportunity.Industry__c,\n\t\tKeyWords__c = Opportunity.KeyWords__c,\n\t\tAmount_Bookings_Value__c = Opportunity.Amount_Bookings_Value__c,\n\t\tAmount_Bookings__c = Opportunity.Amount_Bookings__c,\n\t\tAmount_DBP_Combined_Bookings__c = Opportunity.Amount_DBP_Combined_Bookings__c,\n\t\tSAG_Organization_Account__c = Opportunity.SAG_Organization_Account__c,\n\t\tGDD_Number__c = Opportunity.GDD_Number__c,\n\t\tReason_s_for_non_competitive_loss__c = Opportunity.Reason_s_for_non_competitive_loss__c,\n\t\tReason_s_for_competitive_loss__c = Opportunity.Reason_s_for_competitive_loss__c,\n\t\tAmount_A2_Bookings__c = Opportunity.Amount_A2_Bookings__c,\n\t\tAmount_A_N_Bookings__c = Opportunity.Amount_A_N_Bookings__c,\n\t\tAmount_Integration_Bookings__c = Opportunity.Amount_Integration_Bookings__c,\n\t\tAmount_IoT_Analytics_Bookings__c = Opportunity.Amount_IoT_Analytics_Bookings__c,\n\t\tGDD_Version_Number__c = Opportunity.GDD_Version_Number__c,\n\t\tBoard_Responsible__c = Opportunity.Board_Responsible__c,\n\t\tDivision__c = Opportunity.Division__c,\n\t\tCluster__c = Opportunity.Cluster__c,\n\t\tSales_Region__c = Opportunity.Sales_Region__c,\n\t\tSales_Sub_Region__c = Opportunity.Sales_Sub_Region__c,\n\t\tType_of_Opportunity__c = Opportunity.Type_of_Opportunity__c,\n\t\tOpportunity_Number__c = Opportunity.Opportunity_Number__c,\n\t\tOpportunity_Record_Type_Text__c = Opportunity.Opportunity_Record_Type_Text__c,\n\t\tDate_5__c = Opportunity.Date_5__c,\n\t\tALTF__Altify_Opportunity__c = Opportunity.ALTF__Altify_Opportunity__c,\n\t\tAmount_100__c = Opportunity.Amount_100__c,\n\t\tAge__c = Opportunity.Age__c,\n\t\tAltify_Opportunity_Plan_Score__c = Opportunity.Altify_Opportunity_Plan_Score__c,\n\t\tSQO_Accepted_Month__c = Opportunity.SQO_Accepted_Month__c,\n\t\tIncremental__c = Opportunity.Incremental__c,\n\t\tCount_Opp_Partners__c = Opportunity.Count_Opp_Partners__c,\n\t\tPrimary_Campaign_Category__c = Opportunity.Primary_Campaign_Category__c,\n\t\tSales_Organization__c = Opportunity.Sales_Organization__c,\n\t\tDeal_Type__c = Opportunity.Deal_Type__c,\n\t\tSQO_Accepted_Date__c = Opportunity.SQO_Accepted_Date__c,\n\t\tCount_Primary_Partners__c = Opportunity.Count_Primary_Partners__c,\n\t\tAmount_10__c = Opportunity.Amount_10__c,\n\t\tAmount_30__c = Opportunity.Amount_30__c,\n\t\tCMS_Link__c = Opportunity.CMS_Link__c,\n\t\tAmount_Value__c = Opportunity.Amount_Value__c,\n\t\tRenewal__c = Opportunity.Renewal__c,\n\t\tAmount_50__c = Opportunity.Amount_50__c,\n\t\tAmount_70__c = Opportunity.Amount_70__c,\n\t\tAmount_90__c = Opportunity.Amount_90__c,\n\t\tDate_30__c = Opportunity.Date_30__c,\n\t\tDate_50__c = Opportunity.Date_50__c,\n\t\tDate_70__c = Opportunity.Date_70__c,\n\t\tDate_90__c = Opportunity.Date_90__c,\n\t\tDuration_10_30__c = Opportunity.Duration_10_30__c,\n\t\tDuration_30_50__c = Opportunity.Duration_30_50__c,\n\t\tDuration_50_70__c = Opportunity.Duration_50_70__c,\n\t\tDuration_70_90__c = Opportunity.Duration_70_90__c,\n\t\tSQO_Age__c = Opportunity.SQO_Age__c,\n\t\tDuration_90_100__c = Opportunity.Duration_90_100__c,\n\t\tAltify_Completeness__c = Opportunity.Altify_Completeness__c,\n\t\tDate_100__c = Opportunity.Date_100__c,\n\t\tAmount_TrendMiner_Bookings__c = Opportunity.Amount_TrendMiner_Bookings__c,\n\t\tOutreach_Last_Touch_Contact__c = Opportunity.Outreach_Last_Touch_Contact__c,\n\t\tOutreach_Last_Touch_Sequence__c = Opportunity.Outreach_Last_Touch_Sequence__c,\n\t\tPrimary_Contact__c = Opportunity.Primary_Contact__c,\n\t\tAltify_Plan_Status__c = Opportunity.Altify_Plan_Status__c,\n\t\tAltify_Reporting_Amount__c = Opportunity.Altify_Reporting_Amount__c,\n\t\tAltify_Sales_Process_Status__c = Opportunity.Altify_Sales_Process_Status__c,\n\t\tAltify_T_I_Status__c = Opportunity.Altify_T_I_Status__c,\n\t\tIngestionDate\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> JsonToTabularFormat\nJsonToTabularFormat filter(not(isNull(Id))) ~> RemoveNullValuesFromId\nRemoveNullValuesFromId derive(IngestionDate = toDate(split(split(IngestionDate, '/')[6],'_')[1])) ~> ConvertIngestionDateFromStringToDate\nConvertIngestionDateFromStringToDate sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError') ~> StoreToDatabase"
		}
	}
}